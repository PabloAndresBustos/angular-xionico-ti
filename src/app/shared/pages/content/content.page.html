<app-header />

<ion-content class="bg-gray-50">

  @if (availableDistributors().length > 1) {
  <div class="flex justify-start px-4 lg:px-6 pt-4 bg-white">
    <ion-segment [value]="selectedDistributor()" (ionChange)="selectedDistributor.set($any($event).detail.value!)"
      mode="ios" scrollable="true" class="distributor-pill-segment">
      @for (dist of availableDistributors(); track dist) {
      <ion-segment-button [value]="dist">
        <ion-label class="font-bold">{{ dist }}</ion-label>
      </ion-segment-button>
      }
    </ion-segment>
  </div>
  }

  <div class="p-4 px-0 lg:p-6">
    @if (activeServer(); as data) {
    <section class="bg-gradient-to-r from-(--ion-xionico-color) to-blue-700 rounded-t-3xl p-6 shadow-lg text-white">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-4">
          <div class="bg-white/20 p-3 rounded-2xl backdrop-blur-md">
            <ion-icon name="business-outline" class="text-3xl"></ion-icon>
          </div>
          <div>
            <h1 class="text-3xl font-black m-0 tracking-tight uppercase">
              {{ data.nombreDistribuidora }}
            </h1>
            <p class="text-blue-100 text-xs uppercase tracking-widest font-bold opacity-80">
              Panel de Control Central
            </p>
          </div>
        </div>

        <div
          [class]="data.online ? 'bg-green-500/20 text-green-300 border-green-500/30' : 'bg-red-500/20 text-red-300 border-red-500/30'"
          class="flex items-center gap-2 px-3 py-1 rounded-full border text-[10px] font-bold">
          <span class="w-2 h-2 rounded-full" [class]="data.online ? 'bg-green-400 animate-pulse' : 'bg-red-400'"></span>
          {{ data.online ? 'EN LÍNEA' : 'DESCONECTADO' }}
        </div>
      </div>

      <div class="flex justify-start mt-4">
        <ion-segment [value]="selectedServerId()" (ionChange)="selectedServerId.set($any($event).detail.value!)"
          mode="ios" class="pill-segment">
          @for (server of serversInSelectedDist(); track server.id) {
          <ion-segment-button [value]="server.id">
            <ion-label>ID: {{ server.nombreServidor }}</ion-label>
          </ion-segment-button>
          }
        </ion-segment>
      </div>
    </section>

    <div class="bg-white rounded-b-3xl p-6 shadow-xl border-x border-b border-gray-100 px-0">
      <ion-grid class="ion-no-padding">
        <ion-row class="gap-6">
          <ion-col size="12" size-lg="7">
            <app-cards [title]="'Servicios'" [type]="'services'" [serverData]="data"
              [colNames]="['Favorito', 'Nombre', 'Estado', 'Acción']" [DISTRIBUIDORA_ID]="data.nombreDistribuidora"
              [SERVER_ID]="data.nombreServidor"/>
          </ion-col>

          <ion-col size="12" size-lg="">
            <div class="flex flex-col gap-6">
              <app-cards [title]="'Hardware'" [type]="'hardware'" [hardware]="data.hardware" />
              <app-cards [title]="'Salud Almacenamiento'" [type]="'disk'" [disks]="data.disk_status" />
              <app-cards [title]="'Backups'" [type]="'backups'" [backups]="data.backups" />
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>
    }
  </div>
</ion-content>
